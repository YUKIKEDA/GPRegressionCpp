# 定数カーネル (Constant Kernel)

## 概要

定数カーネルは、ガウス過程において**任意の2点間の共分散が常に同じ定数**となるカーネル関数である。入力 \( \mathbf{x}, \mathbf{x}' \) に依存せず、共分散が一定であるため、**定常カーネル**の一種であり、主に「オフセット」や「バイアス項」として他のカーネルと組み合わせて用いられる。

---

## 数学的定義

定数カーネルは次のように定義される。

$$
k_{\mathrm{Const}}(\mathbf{x}, \mathbf{x}') = \sigma_0^2
$$

ここで、

- $\mathbf{x}, \mathbf{x}' \in \mathbb{R}^d$ ：任意の入力ベクトル
- $\sigma_0^2 > 0$ ：ハイパーパラメータ（定数値、分散に相当）

**入力に依存しない**ため、$\mathbf{x}, \mathbf{x}'$ が何であってもカーネル値は $\sigma_0^2$ である。

---

## カーネル行列

$n$ 個の入力 $X = (\mathbf{x}_1, \ldots, \mathbf{x}_n)^\top$ に対するカーネル行列 $K$ は、

$$
K = \sigma_0^2 \mathbf{1}\mathbf{1}^\top
$$

となる。つまり、**すべての要素が $\sigma_0^2$ の行列**である。

$$
K_{ij} = k(\mathbf{x}_i, \mathbf{x}_j) = \sigma_0^2 \quad \forall i, j
$$

対角成分も $K_{ii} = \sigma_0^2$ である。

---

## 性質

### 定常性

定数カーネルは**定常カーネル**である。$k(\mathbf{x}, \mathbf{x}')$ が $\mathbf{x} - \mathbf{x}'$ にのみ依存する（ここではさらに退化して、差にも依存せず定数）とみなせるためである。

### 正定値性

$\sigma_0^2 > 0$ のとき、カーネル行列 $K = \sigma_0^2 \mathbf{1}\mathbf{1}^\top$ は半正定値である。任意のベクトル $\mathbf{a} \in \mathbb{R}^n$ に対して、

$$
\mathbf{a}^\top K \mathbf{a} = \sigma_0^2 (\mathbf{1}^\top \mathbf{a})^2 \ge 0
$$

となるためである。ガウス過程の共分散として用いるには $\sigma_0^2 > 0$ に制限する。

### 意味づけ

- すべての入力で**同じだけの共分散**を持つため、「どこでも同じ強さで相関している」という非常に単純な事前を表す。
- 単体では「定数オフセット」の分散を表し、他のカーネル（RBF など）と**足し合わせ**て、平均まわりでの変動の大きさ（オフセットの不確実性）を表現するのに使われる。

---

## ハイパーパラメータ

| パラメータ | 記号 | 意味 | 制約 |
|-----------|------|------|------|
| 定数値 | $\sigma_0^2$ | すべてのペアに共通の共分散 | $\sigma_0^2 > 0$ |

### 最適化時のパラメータ化

本実装では、$\sigma_0^2 > 0$ を満たすために**対数スケール**のハイパーパラメータ $\theta$ を導入している。

$$
\theta = \ln(\sigma_0^2) \quad \Leftrightarrow \quad \sigma_0^2 = \exp(\theta)
$$

- `get_hyperparameters()` は $\theta = \ln(\sigma_0^2)$ を返す。
- `set_hyperparameters(theta)` では $\sigma_0^2 = \exp(\theta)$ で内部の定数値を更新する。

これにより、勾配ベースの最適化でも $\sigma_0^2$ が常に正に保たれる。

---

## 他のカーネルとの組み合わせ

定数カーネルは単体で使うより、**加算**で他のカーネルと組み合わせることが多い。

### 例：RBF + 定数

$$
k(\mathbf{x}, \mathbf{x}') = k_{\mathrm{RBF}}(\mathbf{x}, \mathbf{x}') + \sigma_0^2
$$

- RBF 部分：入力の近さに応じた共分散（滑らかさ）
- 定数部分：入力に依存しないオフセットの分散（「全体的な不確実性の底上げ」）

これにより、ガウス過程の事前平均が 0 でなくても、そのまわりの不確実性を定数項で表現できる。

---

## まとめ

- **定義**: $k(\mathbf{x}, \mathbf{x}') = \sigma_0^2$（入力に依存しない定数）。
- **役割**: オフセット・バイアス項。他のカーネルと足して使うことが多い。
- **性質**: 定常、$\sigma_0^2 > 0$ で半正定値。
- **実装**: ハイパーパラメータは対数スケール $\theta = \ln(\sigma_0^2)$ で保持・最適化する。
